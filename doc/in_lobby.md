# ロビー内状態
ロビーはクライアントの送信したアプリケーションIDによって分離されており、同一のアプリケーションIDを使って接続したクライアントはすべて同一のロビーに入ります。現時点ではロビー内で他のクライアントと通信する手段はありません。  
ロビー内にはクライアントの作成したルームが複数存在します。すべてのルームはルーム名によって一意に識別されます。

## サーバー→クライアントのメッセージ
メッセージに追加の情報がある場合、メッセージの後カンマで区切られ、`error`メッセージ以外のメッセージの場合はJSONオブジェクトがテキスト形式で付随します。  
### `joinedLobby`
ロビーに入った直後に送られるメッセージです。追加の情報はありません。このメッセージによって、クライアントが正常にロビー内状態に移行したことが通知されます。  
### `lobbyMember`
ロビー内にいるすべてのメンバーが列挙されます。追加の情報は以下の通りです。
```json
{"members":[
    {"name":(string)},
    {"name":(string)},
    ...
]}
```
このメッセージはあるクライアントがロビーに参加した・ロビーから退出したとき、ロビーに参加しているすべてのクライアント(参加したクライアントそのものも含む)に送信されます。
### `roomList`
ロビー内にあるすべてのルームが列挙されます。追加の情報は以下の通りです。
```json
{"rooms":[
    {
        "name":(string),
        "limit":(number),
        "owner":(string)
    },
    {
        "name":(string),
        "limit":(number),
        "owner":(string)
    },
    ...
]}
```
このメッセージはあるクライアントがロビーに参加したとき、そのクライアントに送信されます。ロビー内のルームが追加・削除、またはそのオプションが変更されたとき、ロビーに参加しているすべてのクライアントに送信されます。
### `leftLobby`
ロビーを退出する直前に送られるメッセージです。追加の情報はありません。このメッセージによって、クライアントが正常にロビー内状態から別の状態に移行することが通知されます。
### `error`
何らかのエラーを伝えるメッセージです。追加の情報はテキストメッセージで表現されます。現時点で、このメッセージはクライアントからのクエリに対する返答です。詳細はクライアント→サーバーのメッセージの各項目を確認してください。
### `exit`
サーバーからの退出を伝えるメッセージです。追加の情報はありません。このメッセージはクライアントからの`exit`クエリに対する返答です。詳細は該当のクエリについての説明を確認してください。

## クライアント→サーバーのメッセージ
クライアントからのメッセージはクエリと呼ばれます(`exit`クエリ内で使われるメッセージを除く)。クエリはすべてJSONオブジェクトであり、`query`フィールドによってクエリ名が示され、クエリに応じて残りのフィールドが解釈されます。
### `create`
ロビー内に新しくルームを作成し、そのルームに参加します。クエリの構造は以下の通りです。
```json
{
    "query":"create",
    "name":(string),
    "limit":(number),
    "owner":(string)
}
```
`name`フィールドは一意なルーム名として解釈されます。すでに同じ名前のルームが存在する場合、`error`メッセージで返答し、処理は中断されます。追加の情報は`Already exist room with this name`です。  
`limit`フィールドはルームに参加できる制限人数として解釈されます。0以下の数が指定された場合、`error`メッセージで返答し、処理は中断されます。追加の情報は`Room limit less than 0`です。  
`owner`フィールドはルームを作成したプレイヤーの名前です。実際にメッセージを送信したプレイヤーの名前と一致する必要はありません。
クエリが正常に処理されると、ルームが作成されクライアントが[ルーム内状態](in_room.md)に移行します。この時、ロビーを退出するクライアントには`roomList`メッセージは送信されません。
### `join`
既に存在するルームの名前を指定し、そのルームに参加します。クエリの構造は以下の通りです。
```json
{
    "query":"join",
    "name":(string)
}
```
`name`フィールドは一意なルーム名として解釈されます。一致するルーム名を持ったルームが存在しない場合、`error`メッセージで返答します。追加の情報は`No room with this name`です。指定されたルームの参加者が制限人数に達していた場合、`error`メッセージで返答し、処理は中断されます。追加の情報は`Hitting room limit`です。
クエリが正常に処理されると、クライアントが[ルーム内状態](in_room.md)に移行します。
### `roomList`
現在ロビー内に存在するルームの一覧(=`roomList`メッセージの送信)を要求します。クエリの構造は以下の通りです。
```json
{
    "query":"roomList"
}
```
クエリが正常に処理されると、サーバーはこのクライアントに`roomList`メッセージを送信します。
### `exit`
サーバーとの接続を切断する要求です。クエリの構造は以下の通りです。
```json
{
    "query":"exit"
}
```
クエリが正常に処理されると、サーバーはこのクライアントに`exit`メッセージを送信し、クライアントはロビー内状態から抜けます。この時、`leftLobby`メッセージは送信されません。この後、クライアントから文字列`exit`を再度送信することで通信は正常に切断されます。  
