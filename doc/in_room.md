# ルーム内状態
ルームは各ロビーの中で一意に識別可能な名前を持ち、また参加可能な人数の上限を持ちます。ルーム内では参加者同士のメッセージのやり取りが可能です。

## サーバー→クライアントのメッセージ
メッセージに追加の情報がある場合、メッセージの後カンマで区切られ、`error`および`tell`メッセージ以外のメッセージの場合はJSONオブジェクトがテキスト形式で付随します。  
### `joinedRoom`
ルームに入った直後に送られるメッセージです。追加の情報はありません。このメッセージによって、クライアントが正常にルーム内状態に移行したことが通知されます。
### `roomMember`
ルーム内にいるすべてのメンバーが列挙されます。追加の情報は以下の通りです。
```json
{"members":[
    {"name":(string)},
    {"name":(string)},
    ...
]}
```
このメッセージはあるクライアントがルームに参加ルームから退出したとき、ルームに参加する参加しているすべてのクライアント(参加したクライアントそのものも含む)に送信されます。
### `roomOption`
ルームが持つルーム名、人数制限、所有者の情報を提供します。追加の情報は以下の通りです。
```json
{
    "name":(string),
    "limit":(number),
    "owner":(string)
}
```
このメッセージはルームのオプションが変更されたとき、ルームに参加しているすべてのクライアントに送信されます。
### `tell`
別のクライアントからのメッセージを伝えます。追加の情報として、送信元のプレイヤー名とメッセージがカンマ区切りで並べられています。
### `leftRoom`
ルームを退出する直前に送られるメッセージです。追加の情報はありません。このメッセージによって、クライアントが正常にルーム内状態から別の状態に移行することが通知されます。
### `exit`
[ロビー内状態における`exit`メッセージ]()と同一です。[`exit`クエリ]()と合わせ、ロビー内状態での説明を確認してください。
### `error`
クライアントからの各クエリに対する返答です。構造は[ロビー内状態における`error`メッセージ]()と同様です。詳細はクライアント→サーバーのメッセージの各項目を確認してください。
## クライアント→サーバーのメッセージ
クライアントからのメッセージはクエリと呼ばれます(`exit`クエリ内で使われるメッセージを除く)。クエリはすべてJSONオブジェクトであり、`query`フィールドによってクエリ名が示され、クエリに応じて残りのフィールドが解釈されます。
### `roomMember`
現在ルームに参加しているすべてのクライアントの一覧(=`roomMember`メッセージ)を要求します。クエリの構造は以下の通りです。
```json
{
    "query":"roomMember"
}
```
クエリが正常に処理されると、サーバーはこのクライアントに`roomMember`メッセージを送信します。
### `roomOption`
現在参加しているルームのルーム名、人数制限、所有者の情報(=`roomOption`メッセージ)を要求します。クエリの構造は以下の通りです。
```json
{
    "query":"roomOption"
}
```
クエリが正常に処理されると、サーバーはこのクライアントに`roomOption`メッセージを送信します。
### `tell`
特定のクライアントにメッセージを送信します。クエリの構造は以下の通りです。
```json
{
    "query":"tell",
    "to":(string),
    "body":(string)
}
```
`to`フィールドはプレイヤー名として解釈されます。該当するプレイヤーが複数いる場合、そのうちの一人にだけメッセージが通知されます。現時点で参加するプレイヤーの名前をチェックする機能はないため、現状では同名プレイヤーが存在することを避けることはできません。 該当するプレイヤーが存在しない場合、`error`メッセージで返答します。追加の情報は`No player with this name`です。 
`body`フィールドは送信するメッセージとして解釈されます。  
クエリが正常に処理されると、`to`フィールドで指定されたプレイヤーに`body`フィールドで指定されたメッセージを`tell`メッセージで送信します。
### `broad`
ルームに参加しているすべてのクライアント(自身含む)にメッセージを送信します。クエリの構造は以下の通りです。
```json
{
    "query":"broad",
    "body":(string)
}
```
`body`フィールドは送信するメッセージとして解釈されます。  
クエリが正常に処理されると、ルームに参加しているすべてのクライアントに`body`フィールドで指定されたメッセージを`tell`メッセージで送信します。
### `leave`
ルームを退出し、ルームが存在するロビーに再度参加します。クエリの構造は以下の通りです。
```json
{
    "query":"leave"
}
```
クエリが正常に処理されると、サーバーはクライアントに`leftRoom`メッセージを送信し、クライアントが[ロビー内状態](in_lobby.md)に移行します。
### `exit`
[ロビー内状態における`exit`クエリ]()と同一です。[`exit`メッセージ]()と合わせ、ロビー内状態での説明を確認してください。